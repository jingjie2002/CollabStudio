[Unit]
Description=CollabStudio Backend Service
# ç¡®ä¿ç½‘ç»œæœåŠ¡å°±ç»ªåå†å¯åŠ¨
After=network.target

[Service]
# =========================================================================
# ğŸ” å®‰å…¨é…ç½®ï¼šä½¿ç”¨é root ç”¨æˆ·è¿è¡Œ
# =========================================================================
# å®‰å…¨åŸåˆ™ï¼šæœ€å°æƒé™åŸåˆ™ï¼Œå³ä½¿æœåŠ¡è¢«æ”»ç ´ï¼Œæ”»å‡»è€…æƒé™ä¹Ÿæœ‰é™
User=ubuntu
Group=ubuntu

# =========================================================================
# ğŸ“ å·¥ä½œç›®å½•é…ç½®
# =========================================================================
# ç¨‹åºä¼šåœ¨æ­¤ç›®å½•ä¸‹å¯»æ‰¾ .envã€uploadsã€dist ç­‰èµ„æº
WorkingDirectory=/home/ubuntu/graduation_project

# =========================================================================
# ğŸš€ å¯åŠ¨å‘½ä»¤
# =========================================================================
ExecStart=/home/ubuntu/graduation_project/collab_server

# =========================================================================
# ğŸ›‘ ä¼˜é›…åœæœºé…ç½®ï¼ˆå…³é”®ï¼ï¼‰
# =========================================================================
# KillSignal=SIGTERMï¼šå‘é€ SIGTERM è€Œé SIGKILL
# è¿™ä¼šè§¦å‘ main.go ä¸­çš„ gracefulShutdown å‡½æ•°ï¼Œæ‰§è¡Œï¼š
#   1. åˆ·æ–° Hub ä¸­çš„æ–‡æ¡£æ•°æ®åˆ°æ•°æ®åº“
#   2. ç­‰å¾…ç°æœ‰è¯·æ±‚å¤„ç†å®Œæ¯•
#   3. å…³é—­æ•°æ®åº“è¿æ¥
# TimeoutStopSec=10ï¼šç»™äºˆ 10 ç§’æ—¶é—´å®Œæˆä¼˜é›…åœæœºï¼Œè¶…æ—¶åˆ™å¼ºåˆ¶ SIGKILL
KillSignal=SIGTERM
TimeoutStopSec=10

# =========================================================================
# ğŸ”„ è‡ªåŠ¨é‡å¯ç­–ç•¥
# =========================================================================
# on-failureï¼šä»…åœ¨éæ­£å¸¸é€€å‡ºæ—¶é‡å¯ï¼ˆå¦‚å´©æºƒï¼‰ï¼Œæ­£å¸¸ stop ä¸ä¼šé‡å¯
Restart=on-failure
RestartSec=5

# =========================================================================
# ğŸ“‹ æ—¥å¿—é…ç½®
# =========================================================================
# æ‰€æœ‰è¾“å‡ºè¿½åŠ åˆ° /var/log/collab.logï¼Œä¾¿äº tail -f å®æ—¶æŸ¥çœ‹
StandardOutput=append:/var/log/collab.log
StandardError=append:/var/log/collab.log

[Install]
# å¼€æœºè‡ªå¯åŠ¨
WantedBy=multi-user.target
